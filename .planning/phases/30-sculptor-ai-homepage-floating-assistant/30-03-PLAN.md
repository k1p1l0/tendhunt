---
phase: 30-sculptor-ai-homepage-floating-assistant
plan: 03
type: execute
wave: 2
depends_on: ["30-01", "30-02"]
files_modified:
  - apps/web/src/components/sculptor/sculptor-homepage.tsx
  - apps/web/src/components/sculptor/recent-conversations.tsx
  - apps/web/src/app/(dashboard)/dashboard/page.tsx
autonomous: true

must_haves:
  truths:
    - "Dashboard home shows animated Sculptor starburst icon above 'Welcome back, {name}' greeting"
    - "Hero chat input is prominently centered below the greeting"
    - "Submitting from hero input opens the AgentPanel Sheet and sends the message"
    - "'Jump back in' section shows recent conversations when they exist"
    - "Suggestion chips appear below the hero input"
    - "Existing dashboard content (AccountManagerCard, SavedScannersSection, FreshSignalsFeed) remains below the fold"
    - "Page still works as server component for data fetching with client component for interactivity"
  artifacts:
    - path: "apps/web/src/components/sculptor/sculptor-homepage.tsx"
      provides: "Main AI-first homepage client component"
      exports: ["SculptorHomepage"]
    - path: "apps/web/src/components/sculptor/recent-conversations.tsx"
      provides: "Jump back in conversation cards"
      exports: ["RecentConversations"]
    - path: "apps/web/src/app/(dashboard)/dashboard/page.tsx"
      provides: "Updated server component fetching conversations"
      contains: "getRecentConversations"
  key_links:
    - from: "apps/web/src/components/sculptor/sculptor-homepage.tsx"
      to: "apps/web/src/stores/agent-store.ts"
      via: "setPanelOpen on hero send"
      pattern: "setPanelOpen.*true"
    - from: "apps/web/src/components/sculptor/sculptor-homepage.tsx"
      to: "apps/web/src/hooks/use-agent.ts"
      via: "useAgent sendMessage for hero input"
      pattern: "useAgent|sendMessage"
    - from: "apps/web/src/app/(dashboard)/dashboard/page.tsx"
      to: "apps/web/src/lib/dashboard.ts"
      via: "getRecentConversations server call"
      pattern: "getRecentConversations"
---

<objective>
Build the SculptorHomepage client component and RecentConversations cards, then restructure the dashboard page to render the AI-first hero layout with the existing dashboard content below the fold.

Purpose: This is the centerpiece of Phase 30 -- transforming the dashboard from a widget grid into an AI-first entry point centered around the Sculptor assistant. The hero input + suggestion chips provide the primary interaction, with recent conversations and existing content supporting discovery.

Output: SculptorHomepage component, RecentConversations component, restructured dashboard page.
</objective>

<execution_context>
@./.claude/get-shit-done/workflows/execute-plan.md
@./.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/phases/30-sculptor-ai-homepage-floating-assistant/30-01-SUMMARY.md
@.planning/phases/30-sculptor-ai-homepage-floating-assistant/30-02-SUMMARY.md
@apps/web/src/app/(dashboard)/dashboard/page.tsx (current dashboard structure)
@apps/web/src/components/sculptor/sculptor-icon.tsx (from Plan 01)
@apps/web/src/components/sculptor/sculptor-hero-input.tsx (from Plan 02)
@apps/web/src/lib/dashboard.ts (getRecentConversations from Plan 02)
@apps/web/src/hooks/use-agent.ts (useAgent hook)
@apps/web/src/stores/agent-store.ts (panelOpen state)
@apps/web/src/components/agent/suggested-actions.tsx (existing suggestion patterns)
@apps/web/src/components/agent/agent-context-setter.tsx
</context>

<tasks>

<task type="auto">
  <name>Task 1: Create RecentConversations and SculptorHomepage components</name>
  <files>
    apps/web/src/components/sculptor/recent-conversations.tsx
    apps/web/src/components/sculptor/sculptor-homepage.tsx
  </files>
  <action>
    **RecentConversations** (`apps/web/src/components/sculptor/recent-conversations.tsx`):
    - "use client" component
    - Props: `conversations: RecentConversation[]` (import type from `@/lib/dashboard`)
    - Renders a section with:
      - Heading: "Jump back in" (text-lg font-semibold)
      - Grid of conversation cards: `grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 gap-3`
      - Each card is a `motion.button` (not a Link -- clicking opens panel with new conversation per research open question #2):
        - `rounded-xl border bg-background p-4 text-left hover:bg-muted/50 transition-colors min-h-[44px]`
        - Staggered entry animation: `initial={{ opacity: 0, y: 8 }}`, `animate={{ opacity: 1, y: 0 }}`, `transition={{ delay: index * 0.05 }}`
        - Content: title (truncated, font-medium text-sm), relative time ("2 hours ago" via simple helper), message count badge
        - onClick: calls `useAgentStore.getState().setPanelOpen(true)` to open Sculptor panel
      - Use `useReducedMotion()` from `motion/react` to disable stagger animation when preferred
    - Helper function `getRelativeTime(date: Date): string` at module level (NOT inside the component -- avoid CI lint error):
      - Calculate diff in minutes/hours/days
      - Return "Just now", "X minutes ago", "X hours ago", "X days ago", "X weeks ago"

    **SculptorHomepage** (`apps/web/src/components/sculptor/sculptor-homepage.tsx`):
    - "use client" component
    - Props interface `SculptorHomepageProps`:
      - `userName: string`
      - `scanners: ScannerSummary[]` (import type from `@/lib/dashboard`)
      - `topScores: TopScore[]` (import type from `@/lib/dashboard`)
      - `recentConversations: RecentConversation[]` (import type from `@/lib/dashboard`)
    - Uses `useAgent()` hook from `@/hooks/use-agent` for `sendMessage` and `isStreaming`
    - Uses `useAgentStore` for `setPanelOpen`
    - Uses `useReducedMotion()` from `motion/react`

    Layout structure:
    ```
    <div className="flex flex-col items-center min-h-[calc(100vh-3.5rem)]">
      {/* AgentContextSetter for dashboard context */}
      <AgentContextSetter context={{ page: "dashboard" }} />

      {/* Hero Section -- vertically centered via flex-1 */}
      <div className="flex-1 flex flex-col items-center justify-center w-full max-w-2xl px-4 pt-8 pb-4">
        {/* Animated starburst icon */}
        <motion.div initial/animate opacity+scale with reduced motion check>
          <SculptorIcon size={64} animate />
        </motion.div>

        {/* Greeting */}
        <motion.div with stagger>
          <h1 className="text-3xl font-bold tracking-tight mt-6 text-center">
            Welcome back, {userName}
          </h1>
          <p className="text-muted-foreground mt-2 text-center">
            What would you like to explore?
          </p>
        </motion.div>

        {/* Hero chat input */}
        <motion.div className="w-full mt-8" with stagger>
          <SculptorHeroInput onSend={handleHeroSend} isStreaming={isStreaming} />
        </motion.div>

        {/* Suggestion chips -- 4 procurement-relevant prompts */}
        <motion.div className="flex flex-wrap gap-2 mt-4 justify-center" with stagger>
          {suggestions.map(s => (
            <button
              key={s}
              onClick={() => handleHeroSend(s)}
              className="rounded-full border px-3 py-1.5 text-sm text-muted-foreground hover:bg-muted/60 hover:text-foreground transition-colors min-h-[44px]"
            >
              {s}
            </button>
          ))}
        </motion.div>
      </div>

      {/* Below-the-fold content */}
      <div className="w-full max-w-5xl px-4 pb-8 space-y-8">
        {recentConversations.length > 0 && (
          <RecentConversations conversations={recentConversations} />
        )}

        {/* Existing dashboard sections */}
        <SavedScannersSection scanners={scanners} />
        <FreshSignalsFeed signals={topScores} />
        <AccountManagerCard {...ACCOUNT_MANAGER} />
      </div>
    </div>
    ```

    **handleHeroSend function** (defined at component level, NOT as a nested component):
    ```typescript
    const handleHeroSend = useCallback((content: string) => {
      useAgentStore.getState().setPanelOpen(true);
      sendMessage(content);
    }, [sendMessage]);
    ```
    This opens the panel first, then sends the message. The useAgent hook handles conversation creation.

    **Suggestion chips content** (define as module-level constant array, NOT inside component):
    ```typescript
    const SUGGESTIONS = [
      "Find NHS trusts with high enrichment scores",
      "Show contracts expiring this month",
      "What are the latest procurement signals?",
      "Which buyers have the highest budgets?",
    ];
    ```

    CRITICAL: Do NOT define any sub-components inside SculptorHomepage (CI lint rule: react-hooks/static-components). All sub-components must be separate imports or module-level render functions.

    Import `AccountManagerCard` from `@/components/dashboard/account-manager-card`, `SavedScannersSection` from `@/components/dashboard/saved-scanners-section`, `FreshSignalsFeed` from `@/components/dashboard/fresh-signals-feed`, and `ACCOUNT_MANAGER` from `@/lib/dashboard`.
  </action>
  <verify>
    Run `pnpm typecheck` to verify type safety across all component props and hook usage.
    Run `cd apps/web && bun run lint` to verify no React compiler lint errors (especially static-components rule).
  </verify>
  <done>
    SculptorHomepage renders AI-first hero layout with animated icon, greeting, hero input, suggestion chips, recent conversations, and existing dashboard content below the fold. Hero input opens AgentPanel and sends message via useAgent hook.
  </done>
</task>

<task type="auto">
  <name>Task 2: Restructure dashboard page.tsx to use SculptorHomepage</name>
  <files>apps/web/src/app/(dashboard)/dashboard/page.tsx</files>
  <action>
    Update `apps/web/src/app/(dashboard)/dashboard/page.tsx`:
    - Keep as server component (async function)
    - Keep existing `auth()` and `redirect` logic
    - Add `getRecentConversations` to the import from `@/lib/dashboard`
    - Add `getRecentConversations(userId, 5)` to the existing `Promise.all` call (now fetches user, scanners, topScores, AND recentConversations in parallel)
    - Remove all existing JSX (the old h1, grid layout, direct component rendering)
    - Import `SculptorHomepage` from `@/components/sculptor/sculptor-homepage`
    - Remove `AgentContextSetter` import (now handled inside SculptorHomepage)
    - Remove `QuickActions` import (replaced by suggestion chips in hero)
    - Return `<SculptorHomepage userName={...} scanners={...} topScores={...} recentConversations={...} />`
    - Serialize dates for serverâ†’client boundary: map recentConversations to ensure `lastMessageAt` is a plain Date object (lean() returns POJO dates which serialize fine with Next.js server components)

    The page.tsx should be clean and minimal -- just data fetching and delegation to the client component.
  </action>
  <verify>
    Run `pnpm typecheck` to verify server/client boundary is clean. Run `cd apps/web && bun run lint` to check for lint issues.
  </verify>
  <done>
    Dashboard page.tsx is a clean server component that fetches user, scanners, topScores, and recentConversations in parallel, then renders SculptorHomepage with all data as props.
  </done>
</task>

</tasks>

<verification>
1. `pnpm typecheck` passes with no errors
2. `cd apps/web && bun run lint` passes with no errors
3. Dashboard page renders SculptorHomepage with animated icon, greeting, hero input, suggestions
4. Hero input sends message AND opens panel simultaneously
5. Recent conversations section appears when conversations exist
6. Existing dashboard content (scanners, signals, account manager) appears below the fold
7. No components defined inside render bodies
8. All animations use useReducedMotion for accessibility
</verification>

<success_criteria>
- Dashboard home shows AI-first hero with Sculptor icon, greeting, and chat input
- Hero send triggers panel open + message send via useAgent hook
- Recent conversations render as cards with relative timestamps
- Existing dashboard content preserved below the fold
- Server component fetches data, client component handles interactivity
- No typecheck or lint errors
</success_criteria>

<output>
After completion, create `.planning/phases/30-sculptor-ai-homepage-floating-assistant/30-03-SUMMARY.md`
</output>
