---
phase: 18-admin-panel
plan: 01
type: execute
wave: 1
depends_on: []
files_modified:
  - apps/admin/package.json
  - apps/admin/tsconfig.json
  - apps/admin/next.config.ts
  - apps/admin/postcss.config.mjs
  - apps/admin/src/app/globals.css
  - apps/admin/src/app/layout.tsx
  - apps/admin/src/app/(dashboard)/layout.tsx
  - apps/admin/src/app/(auth)/sign-in/[[...sign-in]]/page.tsx
  - apps/admin/src/app/(auth)/sign-up/[[...sign-up]]/page.tsx
  - apps/admin/src/proxy.ts
  - apps/admin/src/lib/mongodb.ts
  - apps/admin/src/lib/utils.ts
  - apps/admin/src/components/layout/app-sidebar.tsx
  - apps/admin/src/components/layout/header.tsx
  - apps/admin/components.json
  - apps/admin/.env.local.example
  - package.json
autonomous: true

must_haves:
  truths:
    - "Admin app builds successfully as standalone Next.js 16.1 project"
    - "Non-admin users are blocked from accessing any admin page"
    - "Admin sidebar shows navigation for Overview, Workers, Data, Users"
    - "MongoDB connection works and can query existing collections"
  artifacts:
    - path: "apps/admin/package.json"
      provides: "Admin app workspace config"
      contains: "@tendhunt/admin"
    - path: "apps/admin/src/proxy.ts"
      provides: "Admin role guard middleware"
      contains: "role.*admin"
    - path: "apps/admin/src/components/layout/app-sidebar.tsx"
      provides: "Admin sidebar navigation"
      contains: "Workers"
    - path: "apps/admin/src/lib/mongodb.ts"
      provides: "MongoDB connection singleton"
      contains: "dbConnect"
  key_links:
    - from: "apps/admin/src/proxy.ts"
      to: "Clerk publicMetadata.role"
      via: "middleware admin check"
      pattern: "publicMetadata.*role.*admin"
    - from: "apps/admin/src/app/(dashboard)/layout.tsx"
      to: "apps/admin/src/components/layout/app-sidebar.tsx"
      via: "SidebarProvider layout"
      pattern: "SidebarProvider"
---

<objective>
Scaffold the admin app (`apps/admin/`) as a new Next.js 16.1 workspace with Clerk authentication, admin role guard, MongoDB connection, shadcn/ui components, and sidebar layout.

Purpose: Foundation for all admin pages. Must be a working, buildable app with auth protection before any dashboard pages are added.
Output: Buildable admin app with sidebar layout, sign-in pages, admin-only middleware, and MongoDB connection.
</objective>

<execution_context>
@./.claude/get-shit-done/workflows/execute-plan.md
@./.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/ROADMAP.md
@.planning/STATE.md
@apps/web/package.json
@apps/web/tsconfig.json
@apps/web/next.config.ts
@apps/web/src/proxy.ts
@apps/web/src/lib/mongodb.ts
@apps/web/src/app/layout.tsx
@apps/web/src/app/(dashboard)/layout.tsx
@apps/web/src/components/layout/app-sidebar.tsx
@apps/web/src/components/layout/header.tsx
@package.json
</context>

<tasks>

<task type="auto">
  <name>Task 1: Create admin app scaffold with Next.js 16.1, Tailwind CSS 4.1, Clerk, Mongoose</name>
  <files>
    apps/admin/package.json
    apps/admin/tsconfig.json
    apps/admin/next.config.ts
    apps/admin/postcss.config.mjs
    apps/admin/src/app/globals.css
    apps/admin/src/app/layout.tsx
    apps/admin/src/app/(auth)/sign-in/[[...sign-in]]/page.tsx
    apps/admin/src/app/(auth)/sign-up/[[...sign-up]]/page.tsx
    apps/admin/src/lib/mongodb.ts
    apps/admin/src/lib/utils.ts
    apps/admin/.env.local.example
    apps/admin/components.json
    package.json
  </files>
  <action>
    Create `apps/admin/` directory structure mirroring `apps/web/` patterns:

    1. **package.json**: Name `@tendhunt/admin`, copy dependency versions from apps/web for: next@16.1.6, react@19.2.3, react-dom@19.2.3, @clerk/nextjs, mongoose@^9.2.0, lucide-react, class-variance-authority, clsx, tailwind-merge, date-fns, recharts. Dev deps: typescript, @types/node, @types/react, @types/react-dom, tailwindcss@^4, @tailwindcss/postcss, shadcn, tw-animate-css. Scripts: dev, build, start, typecheck (matching web).

    2. **tsconfig.json**: Copy from apps/web exactly (same compilerOptions, paths `@/*` -> `./src/*`).

    3. **next.config.ts**: Minimal config matching apps/web (`turbopack: {}`).

    4. **postcss.config.mjs**: `export default { plugins: { "@tailwindcss/postcss": {} } }` (same as web).

    5. **globals.css**: Copy from apps/web (has Tailwind v4 imports, OKLCH theme tokens, shadcn CSS variables). This is CSS-first Tailwind v4 config.

    6. **Root layout.tsx**: ClerkProvider wrapping children, import globals.css, metadata title "TendHunt Admin". Use same pattern as apps/web root layout.

    7. **Sign-in page**: `apps/admin/src/app/(auth)/sign-in/[[...sign-in]]/page.tsx` — `<SignIn />` from @clerk/nextjs centered on page.

    8. **Sign-up page**: `apps/admin/src/app/(auth)/sign-up/[[...sign-up]]/page.tsx` — `<SignUp />` centered (for admin invitations).

    9. **mongodb.ts**: Copy `apps/web/src/lib/mongodb.ts` verbatim (same dbConnect singleton pattern).

    10. **utils.ts**: Copy `apps/web/src/lib/utils.ts` (cn function with clsx + tailwind-merge).

    11. **.env.local.example**: List required env vars: MONGODB_URI, NEXT_PUBLIC_CLERK_PUBLISHABLE_KEY, CLERK_SECRET_KEY, NEXT_PUBLIC_CLERK_SIGN_IN_URL=/sign-in, NEXT_PUBLIC_CLERK_SIGN_UP_URL=/sign-up, CLOUDFLARE_ACCOUNT_ID, CLOUDFLARE_API_TOKEN.

    12. **components.json**: shadcn/ui config file (same as apps/web — specify aliases for `@/components/ui`, `@/lib/utils`).

    13. **Root package.json**: Add `apps/admin` to workspaces array. Add scripts: `dev:admin`, `build:admin`, `typecheck` chain.

    Then run `cd apps/admin && bunx shadcn@latest add sidebar card badge table button separator avatar dropdown-menu tooltip skeleton tabs input` to install shadcn/ui components.
  </action>
  <verify>
    Run `cd apps/admin && bun install && bun run build` — must build without errors.
    Run `bun run --cwd apps/admin typecheck` — must pass.
  </verify>
  <done>Admin app scaffold builds successfully, is registered as a bun workspace, and has all base dependencies installed.</done>
</task>

<task type="auto">
  <name>Task 2: Admin role middleware + sidebar layout + header + overview placeholder</name>
  <files>
    apps/admin/src/proxy.ts
    apps/admin/src/app/(dashboard)/layout.tsx
    apps/admin/src/app/(dashboard)/page.tsx
    apps/admin/src/components/layout/app-sidebar.tsx
    apps/admin/src/components/layout/header.tsx
  </files>
  <action>
    1. **proxy.ts (middleware)**: Create Clerk middleware that:
       - Allows public routes: `/sign-in(.*)`, `/sign-up(.*)`, `/api/webhooks(.*)`
       - For ALL other routes: requires authentication AND checks admin role
       - Admin check: after `await auth()`, get `sessionClaims?.metadata?.role` — if not `"admin"`, return 403 response or redirect to a "not authorized" message. Alternatively use `clerkClient().users.getUser(userId)` and check `publicMetadata.role === "admin"` as a fallback (same pattern as apps/web proxy.ts for onboarding, but checking role instead).
       - No onboarding gate needed for admin app.
       - Export `config.matcher` same as apps/web.

    2. **Dashboard layout**: `apps/admin/src/app/(dashboard)/layout.tsx`
       - `await auth()` check, redirect to `/sign-in` if no userId
       - SidebarProvider + AppSidebar + SidebarInset + Header + main content area
       - Same structural pattern as apps/web dashboard layout

    3. **AppSidebar**: `apps/admin/src/components/layout/app-sidebar.tsx`
       - SidebarHeader: "TendHunt Admin" text with Shield icon from lucide-react
       - SidebarContent with SidebarGroup containing nav items:
         - Overview (LayoutDashboard icon) -> `/`
         - Workers (Activity icon) -> `/workers`
         - Contracts (FileText icon) -> `/data/contracts`
         - Buyers (Building2 icon) -> `/data/buyers`
         - Signals (Zap icon) -> `/data/signals`
         - Users (Users icon) -> `/users`
       - SidebarFooter with Clerk UserButton
       - Use `usePathname()` to highlight active nav item
       - Mark as "use client" for usePathname

    4. **Header**: `apps/admin/src/components/layout/header.tsx`
       - SidebarTrigger + breadcrumb showing current page name
       - Simple header matching apps/web pattern but simpler (no credit balance)

    5. **Overview placeholder**: `apps/admin/src/app/(dashboard)/page.tsx`
       - Server component with heading "Overview"
       - Placeholder text "Dashboard overview coming soon"
       - This will be replaced in Plan 02
  </action>
  <verify>
    Run `bun run --cwd apps/admin typecheck` — must pass.
    Visually: sidebar renders with all 6 nav items, header shows, overview page displays.
  </verify>
  <done>Admin app has working sidebar layout with 6 navigation items, admin-only middleware blocking non-admin users, and a placeholder overview page.</done>
</task>

</tasks>

<verification>
1. `bun run --cwd apps/admin build` succeeds without errors
2. `bun run --cwd apps/admin typecheck` passes
3. Root `pnpm typecheck` still passes (no regressions)
4. Middleware rejects requests from non-admin users (check publicMetadata.role)
5. Sidebar renders with Overview, Workers, Contracts, Buyers, Signals, Users links
</verification>

<success_criteria>
- Admin app is a buildable, independent Next.js 16.1 workspace in apps/admin/
- Clerk auth blocks non-admin users at middleware level
- Sidebar navigation shows all 6 sections
- MongoDB connection singleton available for API routes
- shadcn/ui components installed and working
</success_criteria>

<output>
After completion, create `.planning/phases/18-admin-panel/18-01-SUMMARY.md`
</output>
