---
phase: 02-data-pipeline
plan: 03
type: execute
wave: 2
depends_on: ["02-01"]
files_modified:
  - scripts/data/signals.json
  - scripts/data/buyers.json
  - scripts/seed-signals.ts
  - scripts/seed-buyers.ts
autonomous: true

must_haves:
  truths:
    - "50-100 pre-processed board minutes signals exist in MongoDB signals collection"
    - "Signals cover all 6 types: PROCUREMENT, STAFFING, STRATEGY, FINANCIAL, PROJECTS, REGULATORY"
    - "Signals span multiple sectors: Health, IT, Construction, Education, Defence, Environment (minimum)"
    - "50-100 buyer organizations with contacts exist in MongoDB buyers collection"
    - "Buyer contacts include realistic names, titles, and email addresses (no LinkedIn per project constraint)"
    - "Running seed scripts again does not create duplicates (idempotent upsert)"
  artifacts:
    - path: "scripts/data/signals.json"
      provides: "75 pre-generated board minutes signal seed records"
      min_lines: 50
    - path: "scripts/data/buyers.json"
      provides: "75 pre-generated buyer organization seed records with contacts"
      min_lines: 50
    - path: "scripts/seed-signals.ts"
      provides: "Signal seeding script using bulkWrite upsert"
      min_lines: 25
    - path: "scripts/seed-buyers.ts"
      provides: "Buyer seeding script using bulkWrite upsert"
      min_lines: 25
  key_links:
    - from: "scripts/seed-signals.ts"
      to: "scripts/data/signals.json"
      via: "JSON import for seed data"
      pattern: "import.*signals.*from"
    - from: "scripts/seed-signals.ts"
      to: "src/models/signal.ts"
      via: "Signal model for bulkWrite"
      pattern: "Signal\\.bulkWrite"
    - from: "scripts/seed-buyers.ts"
      to: "scripts/data/buyers.json"
      via: "JSON import for seed data"
      pattern: "import.*buyers.*from"
    - from: "scripts/seed-buyers.ts"
      to: "src/models/buyer.ts"
      via: "Buyer model for bulkWrite"
      pattern: "Buyer\\.bulkWrite"
---

<objective>
Generate realistic seed data for board minutes signals and buyer contacts, and create ingestion scripts that upsert them into MongoDB.

Purpose: The dashboard (Phase 4) and buying signals feature (Phase 7) need real-looking data to display. Seeded signals demonstrate the board minutes intelligence capability, and seeded buyers demonstrate the contact reveal business model. Both are critical for the investor demo.
Output: Runnable `npm run seed:signals` and `npm run seed:buyers` that populate the signals and buyers collections.
</objective>

<execution_context>
@./.claude/get-shit-done/workflows/execute-plan.md
@./.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/02-data-pipeline/02-RESEARCH.md
@.planning/phases/02-data-pipeline/02-01-SUMMARY.md
@src/models/signal.ts
@src/models/buyer.ts
@scripts/lib/db.ts
</context>

<tasks>

<task type="auto">
  <name>Task 1: Generate seed data JSON files for signals and buyers</name>
  <files>
    scripts/data/signals.json
    scripts/data/buyers.json
  </files>
  <action>
Generate two JSON seed data files with realistic UK public sector data.

**scripts/data/signals.json** -- 75 board minutes signal records:
Each signal must match the Signal Mongoose schema:
```
{
  "organizationName": string (required),
  "signalType": "PROCUREMENT" | "STAFFING" | "STRATEGY" | "FINANCIAL" | "PROJECTS" | "REGULATORY" (required),
  "title": string (required),
  "insight": string (required, 1-3 sentences describing the signal),
  "source": string (e.g., "NHS England Board Meeting Minutes - January 2026"),
  "sourceDate": ISO date string (last 6 months: Aug 2025 - Feb 2026),
  "sector": string (matching CPV sector names from ocds-mapper.ts),
  "confidence": number 0.6-0.95
}
```

**Distribution requirements:**
- All 6 signal types must be represented (at least 10 each):
  - PROCUREMENT: ~15 signals (RFP announcements, framework renewals, budget approvals for procurement)
  - STAFFING: ~12 signals (new CTO/CDO hires, procurement team expansion, reorganizations)
  - STRATEGY: ~12 signals (digital transformation, cloud-first strategies, outsourcing decisions)
  - FINANCIAL: ~12 signals (budget allocations, spending reviews, cost-cutting programs)
  - PROJECTS: ~12 signals (new program approvals, phase 2 funding, major project kickoffs)
  - REGULATORY: ~12 signals (compliance requirements, new regulations driving procurement, audit findings)

- **Sectors** (at least 6 distinct): Health & Social, IT Services, Construction, Education, Environmental Services, Public Administration, Architecture & Engineering, Financial Services

- **Organizations** (use real UK public sector org names, 20-30 distinct):
  NHS England, NHS Digital, Department for Education, Ministry of Defence, Home Office, Cabinet Office, HMRC, Department for Transport, Environment Agency, Highways England, Network Rail, Transport for London, Greater Manchester Combined Authority, Birmingham City Council, Leeds City Council, Manchester City Council, Scottish Government, Welsh Government, Metropolitan Police, Crown Commercial Service, Government Digital Service, National Cyber Security Centre, UK Health Security Agency, Ofsted, Care Quality Commission

- **Realistic content:** Each insight should read like a real summary of board meeting minutes. Reference specific programs, budgets (in GBP), timelines, and decision outcomes.

**scripts/data/buyers.json** -- 75 buyer organization records:
Each buyer must match the Buyer Mongoose schema:
```
{
  "name": string (required, organization name),
  "orgId": string (unique identifier, e.g., "org-nhs-england"),
  "sector": string (matching CPV sector names),
  "region": string (UK regions: London, South East, South West, East of England, West Midlands, East Midlands, North West, North East, Yorkshire and the Humber, Scotland, Wales, Northern Ireland),
  "website": string (real .gov.uk or .nhs.uk URLs),
  "description": string (1-2 sentences about the organization),
  "contractCount": number (10-500 range, realistic for the org size),
  "contacts": [
    {
      "name": string (realistic UK names),
      "title": string (job title: "Head of Procurement", "Chief Digital Officer", "Commercial Director", "Category Manager - IT", "Director of Finance", etc.),
      "email": string (firstname.lastname@org.gov.uk pattern),
      "linkedIn": "" (empty string per project constraint -- no LinkedIn scraping),
      "isRevealed": false
    }
  ]
}
```

**Distribution requirements:**
- 75 distinct organizations across at least 8 sectors
- Each org has 2-4 contacts with different roles
- Use real UK public sector organization names (NHS trusts, government departments, local councils, agencies)
- Regions distributed across the UK (not all London)
- Website URLs should be real .gov.uk, .nhs.uk, or .org.uk domains
- Email format: firstname.lastname@abbreviated-org.gov.uk (e.g., john.smith@nhs.net, jane.doe@education.gov.uk)
- Contact titles should include a mix of: Head of Procurement, Commercial Director, Chief Digital Officer, Director of IT, Category Manager, Head of Estates, Director of Finance, Chief Operating Officer, Programme Director
  </action>
  <verify>
Both JSON files parse as valid JSON. signals.json contains exactly 75 records. buyers.json contains exactly 75 records. Verify signal type distribution (all 6 types present), sector diversity (6+ sectors), and buyer contact structure (each has 2-4 contacts).
  </verify>
  <done>
Two seed data JSON files exist with 75 realistic records each. Signals cover all 6 types across 6+ sectors with real UK public sector organization names. Buyers cover 8+ sectors across UK regions with 2-4 contacts each (no LinkedIn data per project constraint).
  </done>
</task>

<task type="auto">
  <name>Task 2: Create signal and buyer seeding scripts</name>
  <files>
    scripts/seed-signals.ts
    scripts/seed-buyers.ts
  </files>
  <action>
**scripts/seed-signals.ts** -- Signal seeding script:
- Import `connectDB`, `disconnectDB` from `./lib/db`
- Import `Signal` from `../../src/models/signal` (relative path)
- Import signals data from `./data/signals.json` (use `import signalsData from './data/signals.json'` with `assert { type: 'json' }` or read with fs.readFileSync + JSON.parse)
- Main function:
  1. Call `connectDB()`
  2. Build bulkWrite operations: `updateOne` with upsert, filter by `{ organizationName, signalType, title }` (compound uniqueness -- same org + type + title = same signal)
  3. For each signal, parse `sourceDate` string to Date object
  4. Execute `Signal.bulkWrite(ops, { ordered: false })`
  5. Log: `Seeded signals: Upserted: X, Updated: Y, Total in collection: Z`
  6. Log breakdown by signalType: count of each type
  7. Call `disconnectDB()`
- try/catch/finally pattern with timing

**scripts/seed-buyers.ts** -- Buyer seeding script:
- Import `connectDB`, `disconnectDB` from `./lib/db`
- Import `Buyer` from `../../src/models/buyer` (relative path)
- Import buyers data from `./data/buyers.json`
- Main function:
  1. Call `connectDB()`
  2. Build bulkWrite operations: `updateOne` with upsert, filter by `{ orgId }` (unique org identifier)
  3. Execute `Buyer.bulkWrite(ops, { ordered: false })`
  4. Log: `Seeded buyers: Upserted: X, Updated: Y, Total in collection: Z`
  5. Log: `Total contacts across all buyers: N`
  6. Call `disconnectDB()`
- try/catch/finally pattern with timing

**After creating, also update buyer contractCount:**
- After all contracts have been ingested (Plan 02-01 and 02-02), buyer contractCount should ideally be updated via an aggregation pipeline. For now, the seed data has plausible static contractCount values. A future post-ingestion step can run `db.contracts.aggregate([{ $group: { _id: "$buyerName", count: { $sum: 1 } } }])` and update buyers accordingly. This is acceptable for the hackathon -- the static counts are realistic enough for the demo.

**CRITICAL: Test both scripts:**
1. Run `npm run seed:signals` -- verify 75 signals in MongoDB
2. Run `npm run seed:buyers` -- verify 75 buyers in MongoDB
3. Run both again to verify idempotency
4. Verify signal types are all present: `db.signals.distinct("signalType")` should return all 6
5. Verify buyer contacts exist: check a sample buyer has 2-4 contacts array entries
  </action>
  <verify>
`npm run seed:signals` and `npm run seed:buyers` both complete successfully. MongoDB signals collection has 75 documents with all 6 signal types. MongoDB buyers collection has 75 documents with contacts arrays. Re-running both scripts does not create duplicates.
  </verify>
  <done>
Both seeding scripts work end-to-end: signals collection has 75 documents across all 6 signal types and multiple sectors, buyers collection has 75 organizations with 2-4 contacts each. Scripts are idempotent via bulkWrite upsert.
  </done>
</task>

</tasks>

<verification>
After both tasks complete:
1. `ls scripts/data/` shows signals.json, buyers.json
2. `ls scripts/` shows seed-signals.ts, seed-buyers.ts
3. `npm run seed:signals` populates 75 signals in MongoDB
4. `npm run seed:buyers` populates 75 buyers in MongoDB
5. All 6 signal types represented: PROCUREMENT, STAFFING, STRATEGY, FINANCIAL, PROJECTS, REGULATORY
6. Buyers span multiple sectors and UK regions
7. Each buyer has 2-4 contacts with name, title, email (no LinkedIn)
8. Both scripts are idempotent
</verification>

<success_criteria>
- 75 board minutes signals in MongoDB across all 6 types and 6+ sectors (exceeds 50-100 minimum)
- 75 buyer organizations in MongoDB with contacts (exceeds 50-100 minimum)
- Seed data uses real UK public sector organization names
- All contacts have realistic titles and email patterns
- No LinkedIn data (per project constraint)
- Scripts are idempotent
</success_criteria>

<output>
After completion, create `.planning/phases/02-data-pipeline/02-03-SUMMARY.md`
</output>
