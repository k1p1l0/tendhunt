---
phase: 06-buyer-intelligence-credits
plan: 02
type: execute
wave: 2
depends_on: ["06-01"]
files_modified:
  - src/app/(dashboard)/buyers/page.tsx
  - src/app/(dashboard)/buyers/[id]/page.tsx
  - src/components/buyers/buyer-table.tsx
  - src/components/buyers/buyer-header.tsx
  - src/components/buyers/buyer-tabs.tsx
  - src/components/buyers/contracts-tab.tsx
  - src/components/buyers/contacts-tab.tsx
  - src/components/buyers/contact-card.tsx
  - src/components/buyers/signals-tab.tsx
  - src/components/buyers/attributes-tab.tsx
  - src/components/contracts/contract-card.tsx
autonomous: true

must_haves:
  truths:
    - "User can see a sortable table of buyer organizations at /buyers"
    - "Buyers table shows name, sector, region, contract count, contact count, and unlocked badge"
    - "User can click a buyer name to navigate to their profile page"
    - "Buyer profile page shows header with org name, sector, region, contract count, website link"
    - "Buyer profile has 4 tabs: Contracts, Key Contacts, Buying Signals, Buyer Attributes"
    - "Contracts tab shows recent contracts for this buyer organization"
    - "Key Contacts tab shows contact cards with name, job title visible and email/phone blurred when locked"
    - "Buying Signals tab shows signals from board minutes for this organization"
    - "Buyer Attributes tab shows a 3-column grid of scored attribute cards"
    - "Buyer name on contract cards links to the buyer profile page"
  artifacts:
    - path: "src/app/(dashboard)/buyers/page.tsx"
      provides: "Buyers list page with data table"
    - path: "src/app/(dashboard)/buyers/[id]/page.tsx"
      provides: "Buyer profile detail page with tabbed content"
    - path: "src/components/buyers/buyer-table.tsx"
      provides: "Sortable data table of buyer organizations"
    - path: "src/components/buyers/buyer-header.tsx"
      provides: "Buyer profile header card with metadata"
    - path: "src/components/buyers/contacts-tab.tsx"
      provides: "Contacts tab with locked/unlocked contact cards"
    - path: "src/components/buyers/attributes-tab.tsx"
      provides: "3-column grid of scored buyer attribute cards"
  key_links:
    - from: "src/app/(dashboard)/buyers/page.tsx"
      to: "/api/buyers"
      via: "server-side fetchBuyers call"
      pattern: "fetchBuyers"
    - from: "src/app/(dashboard)/buyers/[id]/page.tsx"
      to: "/api/buyers/[id]"
      via: "server-side fetchBuyerById call"
      pattern: "fetchBuyerById"
    - from: "src/components/buyers/buyer-table.tsx"
      to: "/buyers/[id]"
      via: "Link on buyer name column"
      pattern: "Link.*href.*buyers"
    - from: "src/components/contracts/contract-card.tsx"
      to: "/buyers"
      via: "Link on buyerName text"
      pattern: "Link.*href.*buyers"
    - from: "src/components/buyers/contacts-tab.tsx"
      to: "src/components/buyers/contact-card.tsx"
      via: "maps contacts array to ContactCard components"
      pattern: "ContactCard"
---

<objective>
Build the complete buyer UI: sortable buyers list table at /buyers, buyer profile detail page at /buyers/[id] with header card and 4 tabs (Contracts, Key Contacts, Buying Signals, Buyer Attributes), contact cards with blur effect on locked fields, and buyer name links from contract cards.

Purpose: Users can discover and explore buyer organizations, see their contracts/signals/attributes, and view locked contacts -- the visual foundation for the monetization demo.
Output: Fully navigable buyer pages with all 4 profile tabs populated.
</objective>

<execution_context>
@./.claude/get-shit-done/workflows/execute-plan.md
@./.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/06-buyer-intelligence-credits/06-RESEARCH.md
@.planning/phases/06-buyer-intelligence-credits/06-01-SUMMARY.md
@src/lib/buyers.ts
@src/models/buyer.ts
@src/models/contact-reveal.ts
@src/components/contracts/contract-card.tsx
@src/components/layout/breadcrumb-context.tsx
@src/app/(dashboard)/contracts/[id]/page.tsx
</context>

<tasks>

<task type="auto">
  <name>Task 1: Buyers list page with sortable data table and buyer profile page with header and 4 tabs</name>
  <files>
    src/app/(dashboard)/buyers/page.tsx
    src/app/(dashboard)/buyers/[id]/page.tsx
    src/components/buyers/buyer-table.tsx
    src/components/buyers/buyer-header.tsx
    src/components/buyers/buyer-tabs.tsx
    src/components/buyers/contracts-tab.tsx
    src/components/buyers/signals-tab.tsx
    src/components/buyers/attributes-tab.tsx
  </files>
  <action>
    1. **Create BuyerTable component** at `src/components/buyers/buyer-table.tsx`:
       - "use client" component
       - Props: `buyers` array (name, sector, region, contractCount, contactCount, isUnlocked, _id), `total` number
       - Use shadcn Table (TableHeader, TableBody, TableRow, TableHead, TableCell)
       - Columns: Name (Link to /buyers/[id]), Sector (Badge), Region, Contracts (number), Contacts (number), Status (green "Unlocked" Badge or gray "Locked" Badge)
       - Sortable column headers: clicking toggles sort via URL search params (follow contracts page pattern -- use `useRouter` + `useSearchParams` to update URL)
       - Sort indicator arrows on active column
       - Empty state: "No buyer organizations found"

    2. **Rewrite `src/app/(dashboard)/buyers/page.tsx`**:
       - Server component (async function)
       - Import `fetchBuyers` from `@/lib/buyers` and `auth` from `@clerk/nextjs/server`
       - Read `searchParams` (sort, order, page) from props -- `await searchParams` (Next.js 16 pattern)
       - Call `fetchBuyers(userId, { sort, order, page })` server-side
       - Render page header: "Buyers" title + "Explore buyer organizations and unlock contacts" description
       - Render `<BuyerTable buyers={buyers} total={total} />`
       - Add pagination below table if total > 25 (reuse Pagination component from contracts or inline simple prev/next)

    3. **Create BuyerHeader component** at `src/components/buyers/buyer-header.tsx`:
       - Props: buyer object (name, sector, region, contractCount, website, isUnlocked)
       - Layout per locked decision: Header card with org initials avatar (colored circle with first letter, deterministic color from name hash), org name as h1, then metadata row
       - Metadata row: Sector badge, Region text with MapPin icon, Contract count with FileText icon, Website link with ExternalLink icon (opens in new tab, only if website exists)
       - If `isUnlocked`: green "Unlocked" Badge with Unlock icon in the header (top right area)
       - Use Card component for container

    4. **Create BuyerTabs component** at `src/components/buyers/buyer-tabs.tsx`:
       - "use client" component (shadcn Tabs needs client)
       - Props: contracts array, signals array, contacts array, isUnlocked boolean, buyerId string, buyerName string
       - 4 tabs per locked decision: "Contracts", "Key Contacts", "Buying Signals", "Buyer Attributes"
       - Each tab renders the corresponding tab component
       - Default tab: "contracts"

    5. **Create ContractsTab** at `src/components/buyers/contracts-tab.tsx`:
       - Props: contracts array
       - Renders list of contract cards (reuse existing Card components, not full ContractCard to avoid circular deps)
       - Each card: title, value range, published date, status badge, sector badge
       - Link each card to `/contracts/[id]`
       - Empty state: "No contracts found for this buyer" with FileText icon

    6. **Create SignalsTab** at `src/components/buyers/signals-tab.tsx`:
       - Props: signals array
       - Renders list of signal cards in a vertical stack
       - Each card: signal type Badge (colored by type -- PROCUREMENT=blue, STAFFING=purple, STRATEGY=green, FINANCIAL=yellow, PROJECTS=orange, REGULATORY=red), title, insight text, source date, organization name
       - Empty state: "No buying signals found for this buyer" with Bell icon

    7. **Create AttributesTab** at `src/components/buyers/attributes-tab.tsx`:
       - Props: buyer object (contractCount, name, _id for deterministic seed)
       - Per locked decision: 3-column grid of scored attribute cards (matching Starbridge pattern)
       - Factual stats (from data): Contract Count, Active Contracts (hardcode as contractCount for demo), Sectors Covered (hardcode 2-4 based on sector string)
       - AI-generated scores (deterministic from name hash for hackathon): SME Friendliness (0-100), Procurement Complexity (0-100), Innovation Appetite (0-100), Repeat Business (0-100), Response Speed (0-100), Digital Maturity (0-100)
       - Generate deterministic score: `(hashCode(buyerName + attributeName) % 60) + 30` to get scores between 30-90 (realistic range)
       - Each card: Card with label text, info icon (Tooltip with short description), and large numeric score value
       - Score color: green >= 70, yellow >= 50, red < 50
       - Grid: `grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4`

    8. **Create buyer detail page** at `src/app/(dashboard)/buyers/[id]/page.tsx`:
       - Server component
       - `await params` for id (Next.js 16), `auth()` for userId
       - Call `fetchBuyerById(id, userId)` from `@/lib/buyers`
       - `notFound()` if null
       - Use `BreadcrumbSetter` client component (inline in same file or separate) that calls `useBreadcrumb().setBreadcrumb()` with "Buyers > [Name]" breadcrumb (follow scanners/[id]/page.tsx pattern)
       - Render `<BuyerHeader>` then `<BuyerTabs>` passing all data
  </action>
  <verify>
    Run `npx tsc --noEmit` to confirm no TypeScript errors. Run `npm run build` to confirm all pages compile. Verify /buyers and /buyers/[id] routes exist in the build output.
  </verify>
  <done>
    Buyers list page shows sortable table with all columns (name, sector, region, contracts, contacts, unlock status). Clicking a buyer name navigates to /buyers/[id]. Buyer profile shows header card with metadata and 4 working tabs. Contracts tab shows related contracts. Signals tab shows board minutes signals. Attributes tab shows 3-column grid of scored cards. Breadcrumb shows "Buyers > [Name]".
  </done>
</task>

<task type="auto">
  <name>Task 2: Contact cards with blur effect and buyer name links from contract cards</name>
  <files>
    src/components/buyers/contacts-tab.tsx
    src/components/buyers/contact-card.tsx
    src/components/contracts/contract-card.tsx
  </files>
  <action>
    1. **Create ContactCard component** at `src/components/buyers/contact-card.tsx`:
       - "use client" component
       - Props: `contact` object ({ name, title, email, phone?, linkedIn? }), `isUnlocked` boolean
       - Per locked decision: Name + job title ALWAYS visible (even when locked)
       - Layout per Starbridge reference: Name as h4 header (font-semibold), then horizontal row of icon+detail pairs:
         - Building2 icon + job title (always visible, text-muted-foreground)
         - Phone icon + phone number (blurred when locked, or hidden if no phone)
         - Mail icon + email (blurred when locked)
       - **Blur effect** per locked decision: `blur-sm` on phone/email text when `!isUnlocked`. Use: `className={cn("transition-[filter] duration-300 ease-out", !isUnlocked && "blur-sm select-none pointer-events-none")}` wrapping the actual text value
       - **Copy-to-clipboard** buttons: Only shown when `isUnlocked`. Small Copy icon button next to email and phone. Use `navigator.clipboard.writeText()`. Show brief "Copied!" feedback (swap icon to Check for 2 seconds via local state).
       - `aria-hidden={!isUnlocked}` on blurred fields for accessibility
       - Card container: `rounded-lg border p-4 space-y-3`

    2. **Create ContactsTab component** at `src/components/buyers/contacts-tab.tsx`:
       - "use client" component
       - Props: `contacts` array, `isUnlocked` boolean, `buyerId` string, `contactCount` number
       - Per locked decision: Show "X Key Contacts" count at top of tab
       - Render array of ContactCard components, each receiving `isUnlocked`
       - The "Unlock Contacts" button will be added in Plan 03 (this plan renders the cards in their locked/unlocked state based on the `isUnlocked` prop passed from the parent)
       - Empty state: "No contacts found for this buyer" with Users icon

    3. **Update ContractCard** at `src/components/contracts/contract-card.tsx`:
       - Make the `buyerName` text a clickable Link to the buyer profile
       - Problem: ContractCard doesn't have buyerId. We need to look up the buyer by name.
       - Solution: Add an optional `buyerId` prop to ContractCardData interface. If provided, wrap buyerName in `<Link href={/buyers/${buyerId}}>`. If not provided, render buyerName as plain text (backward compatible).
       - The contracts page does not need to pass buyerId -- it stays as-is. But the buyer profile's ContractsTab already has the buyerId available and can pass it.
       - Also: on the main contracts page, we can resolve buyerName -> buyerId later or just leave it as text for now. For the contract detail page, similarly optional.
       - Style the linked buyer name: `text-primary hover:underline` when it's a link, plain text otherwise.
  </action>
  <verify>
    Run `npx tsc --noEmit` to confirm no TypeScript errors. Run `npm run build` to confirm all components compile. Verify ContactCard shows blurred email/phone when isUnlocked=false and clear text with copy buttons when isUnlocked=true.
  </verify>
  <done>
    Contact cards render with name+title visible and email/phone blurred behind CSS blur-sm filter in locked state. When unlocked, blur dissolves with 300ms transition and copy-to-clipboard buttons appear. ContractsTab shows contact count header. ContractCard buyerName optionally links to buyer profile page.
  </done>
</task>

</tasks>

<verification>
- `npx tsc --noEmit` passes with zero errors
- `npm run build` completes successfully
- /buyers page renders sortable buyer table
- /buyers/[id] page renders buyer header + 4 tabs
- Contact cards show blur effect on email/phone when locked
- Buyer name on contract cards can link to buyer profile
- Breadcrumb shows "Buyers > [Org Name]" on profile page
- All 4 tabs have appropriate empty states
- Attributes tab shows 3x3 grid of scored cards
</verification>

<success_criteria>
1. Buyers list page at /buyers shows sortable table with name, sector, region, contracts, contacts, unlock status
2. Clicking buyer name navigates to /buyers/[id] with profile page
3. Profile header shows org name, sector, region, contract count, website link, and optional unlocked badge
4. 4 tabs work: Contracts shows related contracts, Key Contacts shows contact cards, Buying Signals shows signals, Buyer Attributes shows scored grid
5. Contact cards show name+title visible, email/phone blurred when locked
6. Breadcrumb navigation: Buyers > [Org Name]
7. ContractCard buyerName optionally links to buyer profile
</success_criteria>

<output>
After completion, create `.planning/phases/06-buyer-intelligence-credits/06-02-SUMMARY.md`
</output>
