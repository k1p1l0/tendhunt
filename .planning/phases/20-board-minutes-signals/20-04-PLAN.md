---
phase: 20-board-minutes-signals
plan: 04
type: execute
wave: 2
depends_on: ["20-02"]
files_modified:
  - apps/web/src/components/buyers/signals-tab.tsx
autonomous: true

must_haves:
  truths:
    - "User can filter signals by type using toggle pills"
    - "Each filter pill shows signal count for that type"
    - "Signal cards show verbatim quote in blockquote style when present"
    - "Signal cards show entity badges (companies, people, amounts) when present"
    - "Confidence indicator visible on each signal card"
    - "Empty state distinguishes between no signals vs no board documents"
    - "All state transitions are animated (filter pills, card enter/exit)"
  artifacts:
    - path: "apps/web/src/components/buyers/signals-tab.tsx"
      provides: "Enhanced SignalsTab with type filtering, quote display, entity badges, confidence, animations"
      min_lines: 100
  key_links:
    - from: "apps/web/src/components/buyers/signals-tab.tsx"
      to: "Signal data"
      via: "signals prop with optional boardDocumentId, quote, entities, confidence fields"
      pattern: "signal\\.quote|signal\\.entities|signal\\.confidence"
---

<objective>
Enhance the existing SignalsTab component with type filtering pills, signal count badges, quote display, entity tags, confidence indicators, and improved empty states.

Purpose: Display the rich signal data extracted by the board-minutes worker in an actionable, filterable format on buyer profiles.
Output: Enhanced SignalsTab component ready for real signal data.
</objective>

<execution_context>
@./.claude/get-shit-done/workflows/execute-plan.md
@./.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/20-board-minutes-signals/20-02-SUMMARY.md
@apps/web/src/components/buyers/signals-tab.tsx
</context>

<tasks>

<task type="auto">
  <name>Task 1: Add type filtering and enhance signal card display</name>
  <files>
    apps/web/src/components/buyers/signals-tab.tsx
  </files>
  <action>
    Enhance the existing `SignalsTab` component. This is a single-file change -- the component already renders signal cards, we're adding filtering and richer display.

    **1. Update SignalData interface:**
    Add optional fields to match the extended Signal model:
    - `confidence?: number` (0-1)
    - `quote?: string`
    - `entities?: { companies?: string[]; amounts?: string[]; dates?: string[]; people?: string[] }`
    - `boardDocumentId?: string`

    Also add to `SignalsTabProps`:
    - `hasBoardDocuments?: boolean` -- passed from parent to distinguish empty states

    **2. Type filter pills:**
    Add a row of toggle buttons/pills above the signal list. Use `"use client"` directive at the top (component needs useState).

    All 6 signal types as toggleable pills: PROCUREMENT, STAFFING, STRATEGY, FINANCIAL, PROJECTS, REGULATORY. Plus an "All" pill.

    Each pill shows count: `PROCUREMENT (3)`. Use the existing `signalTypeColors` map for pill colors. Active pill gets solid background, inactive gets outline/ghost variant.

    State: `const [activeFilter, setActiveFilter] = useState<string | null>(null)` -- null means "All".

    Filter logic: `const filteredSignals = activeFilter ? signals.filter(s => s.signalType === activeFilter) : signals`

    Only show pills for types that have at least 1 signal (compute counts from `signals` array, only render pills for non-zero counts).

    **3. Confidence indicator:**
    Add a small confidence indicator to each signal card header, next to the date. Display as a percentage: `${Math.round(signal.confidence * 100)}%` in muted-foreground text. Color-code: green >= 0.7, yellow >= 0.4, red < 0.4.

    **4. Quote display:**
    If `signal.quote` exists and is non-empty, render it below the insight text in a blockquote style:
    ```html
    <blockquote className="border-l-2 border-muted-foreground/30 pl-3 mt-2 text-xs text-muted-foreground italic">
      "{signal.quote}"
    </blockquote>
    ```

    **5. Entity badges:**
    If `signal.entities` has any non-empty arrays, render a flex-wrap row of small badges below the quote/insight:
    - Companies: blue badges
    - People: purple badges
    - Amounts: green badges
    - Dates: not shown as badges (already displayed in header date)

    Use shadcn Badge component with `variant="outline"` and small text (text-xs). Cap at 5 entities total to avoid overwhelming the card.

    **6. Improved empty states:**
    - If `signals.length === 0` AND `hasBoardDocuments === false`: Show "Board documents haven't been processed yet. Signals will appear once board meeting minutes are analyzed."
    - If `signals.length === 0` AND `hasBoardDocuments !== false`: Show current "No buying signals found for this buyer" message.
    - When filters active and `filteredSignals.length === 0`: Show "No {activeFilter} signals found" with option to clear filter.

    **7. Animations (MANDATORY per project CLAUDE.md):**
    - Filter pill transitions: CSS transition on background-color and border-color (150ms ease)
    - Signal cards: Use `motion.div` from `motion/react` with `layout` prop for smooth reorder when filter changes. Wrap card list in `AnimatePresence mode="popLayout"`. Each card: `initial={{ opacity: 0, y: 10 }}`, `animate={{ opacity: 1, y: 0 }}`, `exit={{ opacity: 0, y: -10 }}`, `transition={{ duration: 0.15 }}`.
    - Respect `prefers-reduced-motion`: use `useReducedMotion()` from `motion/react`. If reduced motion, skip enter/exit animations (just show/hide).

    **8. Signal count summary:**
    Update the count text at top: show filtered count when filter active: "3 of 12 signals (PROCUREMENT)" vs "12 signals found".

    Keep the existing `signalTypeColors` map. Keep the existing `formatDate` helper.
  </action>
  <verify>
    Run `cd apps/web && pnpm typecheck` to verify component compiles.
    Run `cd apps/web && bun run lint` to check for React compiler lint issues.
    Verify the file contains: useState for filter, motion imports, AnimatePresence, blockquote for quote, Badge for entities, confidence indicator.
  </verify>
  <done>
    SignalsTab component has type filter pills with counts, confidence indicators, quote blockquotes, entity badges, animated card transitions, and context-aware empty states. Type-checks and lints pass.
  </done>
</task>

</tasks>

<verification>
1. `cd apps/web && pnpm typecheck` -- no errors
2. `cd apps/web && bun run lint` -- no errors (React compiler compliant)
3. Component has "use client" directive
4. Filter pills render for each signal type with count
5. Cards show confidence, quote, and entity badges
6. AnimatePresence wraps card list for smooth filter transitions
7. useReducedMotion respected for accessibility
8. Empty states differentiate between no board documents and no signals
</verification>

<success_criteria>
Enhanced SignalsTab displays rich signal data with filtering, confidence indicators, quotes, entity badges, and animations. Backward compatible with existing signal data (new fields are optional). Lints clean.
</success_criteria>

<output>
After completion, create `.planning/phases/20-board-minutes-signals/20-04-SUMMARY.md`
</output>
