---
phase: 16-scanner-ux-polish
plan: 02
type: execute
wave: 2
depends_on: ["16-01"]
files_modified:
  - src/components/scanners/grid/scanner-data-grid.tsx
  - src/app/(dashboard)/scanners/[id]/page.tsx
autonomous: true

must_haves:
  truths:
    - "Double-clicking a non-AI cell on an RFP row navigates to /contracts/[id]"
    - "Double-clicking a non-AI cell on a buyer row navigates to /buyers/[id]"
    - "Double-clicking a non-AI cell on a meetings row opens the EntityDetailSheet (no dedicated page)"
    - "Double-clicking an AI cell opens the AI drawer (not navigation)"
    - "Single-clicking an AI cell still opens the AI drawer"
  artifacts:
    - path: "src/components/scanners/grid/scanner-data-grid.tsx"
      provides: "onCellActivated distinguishes AI vs data column types"
    - path: "src/app/(dashboard)/scanners/[id]/page.tsx"
      provides: "Navigation routing based on scanner type + column type"
  key_links:
    - from: "src/components/scanners/grid/scanner-data-grid.tsx"
      to: "src/app/(dashboard)/scanners/[id]/page.tsx"
      via: "onRowDoubleClick callback with column info"
      pattern: "onRowDoubleClick|onCellActivated"
    - from: "src/app/(dashboard)/scanners/[id]/page.tsx"
      to: "next/navigation"
      via: "useRouter().push for contract/buyer navigation"
      pattern: "router\\.push"
---

<objective>
Add smart double-click navigation to scanner rows: non-AI cells navigate to entity detail pages (contracts or buyers), AI cells open the AI analysis drawer.

Purpose: Users expect double-click to take them to the entity's dedicated page for deeper inspection. AI cells should always open the AI-specific drawer since that's the relevant detail for AI columns.

Output: Context-aware double-click behavior across all scanner types.
</objective>

<execution_context>
@./.claude/get-shit-done/workflows/execute-plan.md
@./.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/16-scanner-ux-polish/16-01-SUMMARY.md
@src/components/scanners/grid/scanner-data-grid.tsx
@src/app/(dashboard)/scanners/[id]/page.tsx
@src/components/scanners/entity-detail-sheet.tsx
@src/components/scanners/ai-cell-drawer.tsx
</context>

<tasks>

<task type="auto">
  <name>Task 1: Update onCellActivated to pass column info for double-click routing</name>
  <files>
    src/components/scanners/grid/scanner-data-grid.tsx
  </files>
  <action>
    The current `onCellActivated` callback (line 824-831) calls `onRowDoubleClick(row)` for every double-click regardless of which column was clicked. We need to distinguish AI columns from data columns.

    **Modify the `ScannerDataGridProps` interface:**
    - Change `onRowDoubleClick` prop signature from `(row: Record<string, unknown>) => void` to `(row: Record<string, unknown>, columnMeta: { type: string; aiColumnId?: string }) => void`
    - This passes the column metadata so the parent can decide whether to navigate or open a drawer

    **Modify `onCellActivated` callback:**
    ```typescript
    const onCellActivated = useCallback(
      (cell: Item) => {
        const [col, rowIdx] = cell;
        const row = displayRows[rowIdx];
        const meta = columnMeta[col];
        if (row && meta) {
          onRowDoubleClick?.(row, { type: meta.type, aiColumnId: meta.aiColumnId });
        }
      },
      [displayRows, columnMeta, onRowDoubleClick]
    );
    ```

    This way the parent page can check if `columnMeta.type === "ai"` and route to the AI drawer instead of navigation.
  </action>
  <verify>
    `npx tsc --noEmit` passes — the updated prop type is compatible with usage in page.tsx (will be updated in Task 2).
  </verify>
  <done>
    `onCellActivated` passes column metadata alongside the row data to the parent callback.
  </done>
</task>

<task type="auto">
  <name>Task 2: Wire double-click navigation in scanner page with type-based routing</name>
  <files>
    src/app/(dashboard)/scanners/[id]/page.tsx
  </files>
  <action>
    **Add `useRouter` from `next/navigation`:**
    - Import `useRouter` from `next/navigation`
    - Initialize `const router = useRouter()` at the top of the component

    **Replace `setDetailRow` with a routing handler:**

    Currently line 1126 passes `onRowDoubleClick={setDetailRow}` which always opens the EntityDetailSheet.

    Create a new handler function `handleRowDoubleClick`:
    ```typescript
    function handleRowDoubleClick(
      row: Record<string, unknown>,
      colMeta: { type: string; aiColumnId?: string }
    ) {
      // AI column double-click → open AI drawer (same as single-click on AI cell)
      if (colMeta.type === "ai" && colMeta.aiColumnId) {
        setDrawerCell({ columnId: colMeta.aiColumnId, entityId: String(row._id) });
        return;
      }

      // Data column double-click → navigate based on scanner type
      const entityId = String(row._id);
      switch (scanner?.type) {
        case "rfps":
          router.push(`/contracts/${entityId}`);
          break;
        case "buyers":
          router.push(`/buyers/${entityId}`);
          break;
        case "meetings":
          // No dedicated meetings page — open the EntityDetailSheet
          setDetailRow(row);
          break;
        default:
          setDetailRow(row);
      }
    }
    ```

    **Update the ScannerDataGrid prop:**
    Replace `onRowDoubleClick={setDetailRow}` with `onRowDoubleClick={handleRowDoubleClick}`

    **Keep EntityDetailSheet:** It is still used for meetings scanner type. Do NOT remove it.

    **Note:** The `detailRow` state and `EntityDetailSheet` rendering stay in place — they are still needed for meetings type and potentially other fallback cases.
  </action>
  <verify>
    `npx tsc --noEmit` passes.
    On an RFP scanner, double-clicking a data cell navigates to `/contracts/[id]`.
    On a buyer scanner, double-clicking a data cell navigates to `/buyers/[id]`.
    On any scanner, double-clicking an AI cell opens the AI drawer (not navigation).
    On a meetings scanner, double-clicking a data cell opens EntityDetailSheet.
    Single-clicking an AI cell still opens the AI drawer (unchanged behavior).
  </verify>
  <done>
    Double-click routes to entity detail pages for RFPs and buyers, opens AI drawer for AI columns, and falls back to EntityDetailSheet for meetings. Single-click AI cell behavior unchanged.
  </done>
</task>

</tasks>

<verification>
1. `npx tsc --noEmit` passes
2. RFP scanner: double-click data cell → navigates to `/contracts/[id]`
3. Buyer scanner: double-click data cell → navigates to `/buyers/[id]`
4. Meetings scanner: double-click data cell → opens EntityDetailSheet
5. Any scanner: double-click AI cell → opens AI drawer
6. Any scanner: single-click AI cell → opens AI drawer (unchanged)
</verification>

<success_criteria>
- Double-click on non-AI cells navigates to the correct entity detail page based on scanner type
- Double-click on AI cells opens the AI analysis drawer (never navigates away)
- Single-click on AI cells continues to open the AI drawer
- Meetings scanner gracefully falls back to EntityDetailSheet side panel
- No TypeScript compilation errors
</success_criteria>

<output>
After completion, create `.planning/phases/16-scanner-ux-polish/16-02-SUMMARY.md`
</output>
