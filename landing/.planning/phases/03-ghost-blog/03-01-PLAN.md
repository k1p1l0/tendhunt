---
phase: 03-ghost-blog
plan: 01
type: execute
wave: 1
depends_on: []
files_modified:
  - /etc/nginx/sites-available/ghost-admin.tendhunt.com
  - /var/www/ghost/config.production.json
  - /etc/systemd/system/ghost_tendhunt.service
autonomous: false
user_setup:
  - service: hetzner
    why: "VPS hosting for Ghost instance"
    manual_steps:
      - task: "Create Hetzner Cloud account and CX22 VPS instance"
        location: "https://console.hetzner.cloud"
        details: "Sign up, add payment method, create CX22 instance (Ubuntu 24.04, 2GB RAM, €4.92/mo). Note the IPv4 address."
      - task: "Set root password or add SSH key during VPS creation"
        location: "Hetzner Cloud console during instance creation"
        details: "Choose SSH key authentication (recommended) or set a root password for initial access."
    env_vars: []
    dashboard_config: []

must_haves:
  truths:
    - "Ghost admin panel loads at ghost-admin.tendhunt.com/ghost with login screen"
    - "Ghost instance is accessible and generating pages at ghost-admin.tendhunt.com"
    - "NGINX serves Ghost over HTTPS with valid Let's Encrypt certificate"
    - "Ghost systemd service restarts automatically on VPS reboot"
    - "MySQL database stores Ghost content and survives service restarts"
    - "RSS feed available at https://ghost-admin.tendhunt.com/rss/ (returns HTTP 200)"
  artifacts:
    - path: "/var/www/ghost/config.production.json"
      provides: "Ghost configuration (database, URL, server port)"
      contains: "\"url\": \"https://ghost-admin.tendhunt.com\""
    - path: "/etc/nginx/sites-available/ghost-admin.tendhunt.com"
      provides: "NGINX reverse proxy config with SSL"
      contains: "ssl_certificate"
    - path: "/etc/systemd/system/ghost_tendhunt.service"
      provides: "Ghost as systemd service with auto-restart"
      contains: "Restart=always"
    - path: "/var/lib/mysql/ghost_production/"
      provides: "MySQL database for Ghost content"
      min_size_kb: 100
  key_links:
    - from: "NGINX (port 443)"
      to: "Ghost (port 2368)"
      via: "proxy_pass http://127.0.0.1:2368"
      pattern: "proxy_pass.*127\\.0\\.0\\.1:2368"
    - from: "Ghost config.production.json"
      to: "MySQL database"
      via: "database.connection settings"
      pattern: "\"host\": \"127\\.0\\.0\\.1\".*\"database\": \"ghost_production\""
    - from: "Let's Encrypt SSL"
      to: "NGINX SSL certificate paths"
      via: "Ghost CLI ssl setup"
      pattern: "ssl_certificate.*letsencrypt"
---

<objective>
Set up a production Ghost 5.x instance on a Hetzner VPS with Ubuntu 24.04, Node.js 22, MySQL, and NGINX with SSL — accessible at ghost-admin.tendhunt.com for admin access and content authoring.

Purpose: Establish the Ghost backend that will later be proxied to tendhunt.com/blog. This plan creates the content management system foundation.

Output: A running Ghost instance with admin panel, database, and SSL-secured subdomain.
</objective>

<execution_context>
@/Users/kirillkozak/Projects/tendhunt.com/.claude/get-shit-done/workflows/execute-plan.md
@/Users/kirillkozak/Projects/tendhunt.com/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@/Users/kirillkozak/Projects/tendhunt.com/landing/.planning/PROJECT.md
@/Users/kirillkozak/Projects/tendhunt.com/landing/.planning/ROADMAP.md
@/Users/kirillkozak/Projects/tendhunt.com/landing/.planning/STATE.md
@/Users/kirillkozak/Projects/tendhunt.com/landing/.planning/phases/03-ghost-blog/03-CONTEXT.md
@/Users/kirillkozak/Projects/tendhunt.com/landing/.planning/phases/03-ghost-blog/03-RESEARCH.md
</context>

<tasks>

<task type="checkpoint:human-action" gate="blocking">
  <name>Create Hetzner Cloud VPS</name>
  <action>
Create a Hetzner Cloud VPS instance for hosting Ghost.

**Instructions:**
1. Go to https://console.hetzner.cloud and sign up (if new account)
2. Create a new project (e.g., "TendHunt Ghost")
3. Create a CX22 instance:
   - Image: Ubuntu 24.04
   - Location: Germany (Falkenstein or Nuremberg recommended for UK latency)
   - Type: CX22 (2 vCPU, 4GB RAM, €4.92/mo)
   - SSH keys: Add your public SSH key OR set root password
4. Wait for instance to provision (2-3 minutes)
5. Note the IPv4 address (format: 123.45.67.89)
6. Verify SSH access: `ssh root@<VPS_IP>`

**Resume signal:** Reply with: "VPS created at IP: [your-ip-here]" once you have SSH access
  </action>
</task>

<task type="auto">
  <name>Install Ghost stack on VPS (Node.js 22, MySQL, NGINX, Ghost CLI)</name>
  <files>
    /var/www/ghost/config.production.json
    /etc/nginx/sites-available/ghost-admin.tendhunt.com
    /etc/systemd/system/ghost_tendhunt.service
  </files>
  <action>
SSH into the VPS and run the following installation steps in sequence:

**1. Update system packages:**
```bash
sudo apt-get update && sudo apt-get upgrade -y
```

**2. Install Node.js 22 LTS via Nodesource:**
```bash
sudo apt-get install -y ca-certificates curl gnupg
sudo mkdir -p /etc/apt/keyrings
curl -fsSL https://deb.nodesource.com/gpgkey/nodesource-repo.gpg.key | sudo gpg --dearmor -o /etc/apt/keyrings/nodesource.gpg
NODE_MAJOR=22
echo "deb [signed-by=/etc/apt/keyrings/nodesource.gpg] https://deb.nodesource.com/node_$NODE_MAJOR.x nodistro main" | sudo tee /etc/apt/sources.list.d/nodesource.list
sudo apt-get update
sudo apt-get install nodejs -y
node -v  # Verify: should show v22.x.x
```

**3. Install MySQL 8.0:**
```bash
sudo apt-get install mysql-server -y
sudo mysql -e "ALTER USER 'root'@'localhost' IDENTIFIED WITH mysql_native_password BY 'TEMP_ROOT_PASSWORD';"
sudo mysql -u root -pTEMP_ROOT_PASSWORD -e "CREATE DATABASE ghost_production; CREATE USER 'ghost_user'@'localhost' IDENTIFIED BY 'SECURE_GHOST_DB_PASSWORD'; GRANT ALL PRIVILEGES ON ghost_production.* TO 'ghost_user'@'localhost'; FLUSH PRIVILEGES;"
```
(Replace `TEMP_ROOT_PASSWORD` and `SECURE_GHOST_DB_PASSWORD` with strong random passwords generated via `openssl rand -base64 32`)

**4. Install NGINX:**
```bash
sudo apt-get install nginx -y
sudo ufw allow 'Nginx Full'
sudo ufw allow OpenSSH
sudo ufw enable
```

**5. Install Ghost CLI globally:**
```bash
sudo npm install ghost-cli@latest -g
```

**6. Create Ghost directory and set ownership:**
```bash
sudo mkdir -p /var/www/ghost
sudo chown $USER:$USER /var/www/ghost
cd /var/www/ghost
```

**7. Run Ghost installation (interactive prompts):**
```bash
ghost install
```

**Prompts to answer during `ghost install`:**
- **Blog URL:** `https://ghost-admin.tendhunt.com`
- **MySQL hostname:** `127.0.0.1` (NOT `localhost` — avoids IPv6 issue)
- **MySQL username:** `ghost_user`
- **MySQL password:** (the `SECURE_GHOST_DB_PASSWORD` from step 3)
- **Database name:** `ghost_production`
- **Set up NGINX?** Yes
- **Set up SSL?** Yes (this triggers Let's Encrypt)
- **Email for SSL (Let's Encrypt):** (your email address)
- **Set up systemd?** Yes
- **Start Ghost?** Yes

**IMPORTANT:** Before running `ghost install`, ensure DNS for `ghost-admin.tendhunt.com` is set:
- Add A record: `ghost-admin.tendhunt.com` → VPS IP address
- Set to **DNS Only** (Cloudflare proxy OFF — orange cloud disabled) until SSL setup completes
- Wait 2-3 minutes for DNS propagation

**8. Verify Ghost is running:**
```bash
ghost status
curl https://ghost-admin.tendhunt.com
```

Expected output: HTML from Ghost homepage.

**9. Enable Cloudflare proxy (optional, after SSL verified):**
- Go to Cloudflare DNS settings
- Change `ghost-admin.tendhunt.com` A record to **Proxied** (orange cloud ON)
- Verify site still loads via HTTPS

**Critical pitfall to avoid:**
- If Let's Encrypt SSL fails during `ghost install`, check:
  - DNS A record points to correct VPS IP
  - Cloudflare proxy is OFF (DNS Only mode)
  - Port 80/443 are open in firewall: `sudo ufw status`
  - If SSL setup failed, re-run: `ghost setup ssl`

Use per user decision (self-hosted on Hetzner) even though research suggested CX23 — user specified CX22 (~€4/mo).
  </action>
  <verify>
1. SSH into VPS: `ssh root@<VPS_IP>`
2. Check Ghost service status: `systemctl status ghost_tendhunt`
   - Should show: `active (running)`
3. Visit https://ghost-admin.tendhunt.com in browser
   - Should load Ghost homepage (default theme)
4. Visit https://ghost-admin.tendhunt.com/ghost
   - Should show Ghost admin login screen (if not set up yet, shows setup wizard)
5. Check NGINX config: `sudo cat /etc/nginx/sites-available/ghost-admin.tendhunt.com`
   - Should contain SSL certificate paths
6. Check MySQL connection: `sudo mysql -u ghost_user -p -e "USE ghost_production; SHOW TABLES;"`
   - Should show Ghost tables (posts, users, etc.)
  </verify>
  <done>
Ghost instance running at ghost-admin.tendhunt.com with valid SSL certificate, admin panel accessible, MySQL database operational, systemd service configured for auto-restart. All verification checks pass.
  </done>
</task>

<task type="checkpoint:human-verify" gate="blocking">
  <name>Verify Ghost installation and SSL setup</name>
  <action>
Verify that Ghost 5.x production instance with SSL is correctly installed on Hetzner VPS.

**What was built:** Ghost 5.x production instance with SSL on Hetzner VPS

**How to verify:**
1. **Admin access test:**
   - Visit: https://ghost-admin.tendhunt.com/ghost
   - Expected: Ghost admin login screen or setup wizard loads
   - If setup wizard: Create admin account (save credentials securely)

2. **SSL certificate test:**
   - Click browser padlock icon on https://ghost-admin.tendhunt.com
   - Expected: Valid certificate issued by Let's Encrypt, not expired

3. **Service persistence test:**
   - SSH into VPS: `ssh root@<VPS_IP>`
   - Restart Ghost: `cd /var/www/ghost && ghost restart`
   - Visit https://ghost-admin.tendhunt.com (should reload within 10 seconds)

4. **Sample post test (optional but recommended):**
   - Log into Ghost admin
   - Create a draft post with title "Test Post"
   - Publish the post
   - Visit https://ghost-admin.tendhunt.com/test-post/
   - Expected: Post renders with default Ghost theme

**If any check fails, describe the error output (browser error, SSL warning, service status, etc.).**

**Resume signal:** Type "approved" if all checks pass, or describe issues encountered
  </action>
</task>

</tasks>

<verification>
1. Ghost homepage loads at https://ghost-admin.tendhunt.com
2. Admin panel accessible at https://ghost-admin.tendhunt.com/ghost
3. SSL certificate valid (Let's Encrypt, not self-signed or expired)
4. `systemctl status ghost_tendhunt` shows service running
5. MySQL database contains Ghost tables and accepts connections from Ghost
6. NGINX reverse proxy correctly forwards requests to Ghost on port 2368
7. Ghost survives service restart (`ghost restart` completes without errors)
8. RSS feed available at https://ghost-admin.tendhunt.com/rss/ (HTTP 200 status)
</verification>

<success_criteria>
- Ghost 5.x instance running on Ubuntu 24.04 VPS with Node.js 22 LTS
- Admin panel accessible via ghost-admin.tendhunt.com/ghost with HTTPS
- MySQL database operational and storing Ghost content
- NGINX configured as reverse proxy with Let's Encrypt SSL (auto-renewal enabled)
- Ghost systemd service configured for automatic restart on failures and reboots
- DNS A record for ghost-admin.tendhunt.com points to VPS IP
</success_criteria>

<output>
After completion, create `landing/.planning/phases/03-ghost-blog/03-01-SUMMARY.md` with:
- VPS IP address and SSH access details
- MySQL credentials (database name, username, hashed password location)
- Ghost installation directory path
- NGINX config file location
- SSL certificate paths and renewal info
- Any deviations from standard setup
</output>
